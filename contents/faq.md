# 本ページはメンテナンス中です。

[↑トップページに戻る](./README.md)
<br>
# よくあるご質問

本ページでは、SmartCS x Ansible の連携機能を利用するにあたり、  
SmartCS の動作、設定方法、Ansible 連携機能などに関連するよくあるご質問と回答を掲載しています。  

<br>

## 目次
- [1. SmartCS を経由して手動で接続しているシリアルセッションの切断方法を教えてください。](./faq.md#1-smartcs-を経由して手動で接続しているシリアルセッションの切断方法を教えてください)
- [2. 拡張ユーザ(extusr グループのユーザ)の用途を教えてください。](./faq.md#2-拡張ユーザの用途を教えてください)
- [3. ポートユーザ(portusr グループのユーザ)で 93xx ポート(SSH トランスペアレント接続機能のポート)へ手動で接続した際のセッション切断方法を教えてください。](./faq.md#3-ポートユーザで93xx-ポートへ手動で接続した際のセッション切断方法を教えてください)
- [4. smartcs_tty_command モジュールを使用した Playbook は、どのような手順で作成すれば良いでしょうか。](./faq.md#4-smartcs_tty_command-モジュールを使用した-Playbook-はどのような手順で作成すれば良いでしょうか)
- [5. sendchar オプションで指定した文字列はどのような順番で実行されるのでしょうか。また、recvchar オプションで指定する文字列は、sendchar オプションで指定する文字列と記載する順番を合わせる必要があるのでしょうか。](./faq.md#5-sendchar-オプションで指定した文字列はどのような順番で実行されるのでしょうかまたrecvchar-オプションで指定する文字列はsendchar-オプションで指定する文字列と記載する順番を合わせる必要があるのでしょうか)
- [6. custom_response オプションを有効にした際の stdout_lines_custom において、一つの送信コマンドに対するresponse はどのように判断しているのでしょうか。また、設定反映時のログ情報がコンソールに出力されるのですが、どのように対処すれば良いでしょうか。](./faq.md#6-custom_response-オプションを有効にした際の-stdout_lines_custom-において一つの送信コマンドに対するresponse-はどのように判断しているのでしょうかまた設定反映時のログ情報がコンソールに出力されるのですがどのように対処すれば良いでしょうか)

<br>
<br>

### 1. SmartCS を経由して手動で接続しているシリアルセッションの切断方法を教えてください。
SmartCS のダイレクトモード、セレクトモードで接続しているシリアルセッションは、tty ごとに設定可能な`Ctrl+XX` という切替え文字で切断することができます。  
デフォルトでは設定無しとなっており、`set portd tty cmdchar` コマンドで設定する必要があります。  
例えば、tty1 の切替え文字コードとして`Ctrl+A` を設定する場合のコマンド実行例は下記の通りです。  
```
(0)NS-2250# set portd tty 1 cmdchar 01
```
<br>

### 2. 拡張ユーザの用途を教えてください。
拡張ユーザ(extusr グループのユーザ)は、設定により権限を付与できるユーザです。  
tty マネージ機能の権限を付与することで、Ansible と連携して SmartCS modules for Ansible を利用することが可能となります。  

各ユーザの権限は下記の通りで、拡張ユーザは基本的に手動での接続には利用しないユーザです。  
・一般ユーザ：SmartCS へ本体ログインし、設定情報の取得、および設定変更を除くコマンド実行が可能なユーザ  
・装置管理ユーザ：一般ユーザや拡張ユーザから su コマンドで移行し、設定情報の取得、および設定変更を含む全てのコマンド実行が可能なユーザ  
・ポートユーザ：SmartCS のポートサーバーへアクセスし、シリアルポートに接続された装置へアクセスするためのユーザ  
・拡張ユーザ：一般ユーザの権限に加え、Ansible と連携してシリアルポートに接続された装置へアクセス可能なユーザ  
<br>

### 3. ポートユーザで93xx ポートへ手動で接続した際のセッション切断方法を教えてください。
93xx ポート(SSH トランスペアレント接続機能のポート)はベンダーモジュール連携機能を実行する際に使用するポートであり、手動でのシリアルポート接続を想定しておりません。  
切替え文字( Ctrl+XX )の入力でセッションを切断することはできませんので、Teraterm などご利用のターミナルソフトを閉じてセッションを切断してください。  
<br>

### 4. smartcs_tty_command モジュールを使用した Playbook は、どのような手順で作成すれば良いでしょうか。
`smartcs_tty_command` モジュールを利用する場合、送信する文字列(sendchar)と受信が期待される文字列(recvchar)をPlaybook に記載する必要があります。  
文字列(sendchar)を送信した際にどのような文字列(recvchar)が出力されるかが重要となりますので、  
1. 送信する文字列(コマンドなど)、受信する文字列(プロンプトなど)を実際に確認しながらPlaybook を作成  
2. 作成したPlaybook が正しく動作するかどうかを確認  
という手順となります。  

ターゲット装置のコンソールポートと接続するため、コンソールログの出力や、接続開始時のコンソールの状態(ログイン前、ログイン後、コンフィギュレーションモード、など)を考慮する必要があります。  

また、SmartCS のミラーリング機能を活用することで、Playbook の実行によりオペレーションが確実に実行されているかどうかをリアルタイムに確認することができます。  
Playbook 作成の段階では、オペレーションが途中で停止してしまい対象機器から手動でログアウトさせたい場合がありますので、Ansible によるオペレーションを実行しながらノーマルモード(RW)のセッションを別に開いておくと便利です。  
誤操作防止のために上述の①Ansible と②ノーマルモード(RW)のセッション は、デフォルトでは排他がかかるよう制限されています。排他制御を無効にする場合は、SmartCS に下記の設定を行ってください。  
```
(0)NS-2250# set portd service exclusive off
```
<br>

### 5. sendchar オプションで指定した文字列はどのような順番で実行されるのでしょうか。また、recvchar オプションで指定する文字列は、sendchar オプションで指定する文字列と記載する順番を合わせる必要があるのでしょうか。
`sendchar` オプションで指定した文字列はリストの上から順番に送信されます。  
また、`recvchar` オプションで指定する文字列の順番は`sendchar` オプションで指定する文字列と合わせる必要はありません。リスト内のいずれかの文字列を受信すると、次の`sendchar` を送信します。  
<br>

### 6. custom_response オプションを有効にした際の stdout_lines_custom において、一つの送信コマンドに対するresponse はどのように判断しているのでしょうか。また、設定反映時のログ情報がコンソールに出力されるのですが、どのように対処すれば良いでしょうか。
`custom_response` オプションを有効にした際に出力される`stdout_lines_custom` の`response` 部分には、`sendchar` オプションで指定した文字列(execute_command に格納される内容)を送信してから、`recvchar` オプションで指定した文字列のいずれかを受信するまでの入出力情報が含まれます。  
`stdout_lines_custom` に含まれる`response` から必要な部分だけをパースしていただくか、設定反映時のログ情報などの不要な行を削除していただくことになります。  
<br>

[↑トップページに戻る](./README.md)
